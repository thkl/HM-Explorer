{"version":3,"file":"ccu_communication.js","sources":["src/ccu/ccu_communication.js"],"sourcesContent":["const http = require('http')\nconst binrpc = require('binrpc')\nconst xmlrpc = require('homematic-xmlrpc')\n\n\nclass CCUCommunication {\n\t\n\n    constructor(ccuip) {\n\t   this.ccuIp = ccuip\n\t}\n\t\n\t\n\tsendInterfaceCommand(interfc,command,attributes,callback) {\n\t   var client\n\t   switch (interfc.type) {\n\t\t    case \"BidCos-RF\":\n\t\t\t  client  = binrpc.createClient({ host: interfc.host, port: interfc.port, path: interfc.path})\n\t\t\t  break;\n\t   } \n\t   \n\t   console.log(\"send %s to %s:%s\",command,interfc.host,interfc.port)\t\t\t\n\n\t   \n\t   client.methodCall(command,attributes , function (error, value) {\n\t   \tif (callback) {\n\t\t   \tcallback(error,value)\n\t   \t}\n\t   })\n\t}\n\t\n\tsendRegaCommand(script,callback) {\n\t\tvar encoding = require(\"encoding\");\n\t\tscript = encoding.convert(script, \"binary\");\n\t\tvar that = this\n\t\tvar options = {\n\t\t\thost: this.ccuIp,\n\t\t\tport: 8181,\n\t\t\tpath: '/tclrega.exe',\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Length': Buffer.byteLength(script)\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\tconsole.log('CCU at Rega Command :%s',script.toString());\n\t\n\t\tvar request = http.request(options, function(response) {\n\t\tvar data = '';\n\t\n\t\tresponse.setEncoding(\"binary\");\n\n\t\n\t\tresponse.on('data', function(chunk) {\n      \t  data += chunk.toString();\n      \t});\n      \n\t  \tresponse.on('end', function() {\n\t\t   var pos = data.lastIndexOf('<xml><exec>')\n\t \t   var tx = (data.substring(0, pos))\n\t \t   var vars = data.substr(pos)\n\t \t   console.log('CCU Rega Response :%s',tx)\n\t \t   \tcallback(tx,vars);\n\t \t   });\n\n\t\t}).on('error', function(e) {\n\t      console.error(e)\n\t\t});\n\n\t\trequest.write(script);\n\t\trequest.end();\n\t}\n}\n\nmodule.exports = CCUCommunication;\n"],"names":[],"mappings":";;AAAA,MAAM,IAAI,GAAG,OAAO,CAAC,MAAM,EAAC;AAC5B,MAAM,MAAM,GAAG,OAAO,CAAC,QAAQ,EAAC;AAChC,MAAM,MAAM,GAAG,OAAO,CAAC,kBAAkB,EAAC;;;AAG1C,MAAM,gBAAgB,CAAC;;;IAGnB,WAAW,CAAC,KAAK,EAAE;IACnB,IAAI,CAAC,KAAK,GAAG,MAAK;EACpB;;;CAGD,oBAAoB,CAAC,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,QAAQ,EAAE;IACvD,IAAI,OAAM;IACV,QAAQ,OAAO,CAAC,IAAI;MAClB,KAAK,WAAW;KACjB,MAAM,IAAI,MAAM,CAAC,YAAY,CAAC,EAAE,IAAI,EAAE,OAAO,CAAC,IAAI,EAAE,IAAI,EAAE,OAAO,CAAC,IAAI,EAAE,IAAI,EAAE,OAAO,CAAC,IAAI,CAAC,EAAC;KAC5F,MAAM;KACN;;IAED,OAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,EAAC;;;IAGjE,MAAM,CAAC,UAAU,CAAC,OAAO,CAAC,UAAU,GAAG,UAAU,KAAK,EAAE,KAAK,EAAE;KAC9D,IAAI,QAAQ,EAAE;MACb,QAAQ,CAAC,KAAK,CAAC,KAAK,EAAC;MACrB;KACD,EAAC;EACJ;;CAED,eAAe,CAAC,MAAM,CAAC,QAAQ,EAAE;EAChC,IAAI,QAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;EACnC,MAAM,GAAG,QAAQ,CAAC,OAAO,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;EAC5C,IAAI,IAAI,GAAG,KAAI;EACf,IAAI,OAAO,GAAG;GACb,IAAI,EAAE,IAAI,CAAC,KAAK;GAChB,IAAI,EAAE,IAAI;GACV,IAAI,EAAE,cAAc;GACpB,MAAM,EAAE,MAAM;GACd,OAAO,EAAE;IACR,gBAAgB,EAAE,MAAM,CAAC,UAAU,CAAC,MAAM,CAAC;IAC3C;IACD;;;EAGD,OAAO,CAAC,GAAG,CAAC,yBAAyB,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,CAAC;;EAEzD,IAAI,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,SAAS,QAAQ,EAAE;EACvD,IAAI,IAAI,GAAG,EAAE,CAAC;;EAEd,QAAQ,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;;;EAG/B,QAAQ,CAAC,EAAE,CAAC,MAAM,EAAE,SAAS,KAAK,EAAE;SAC7B,IAAI,IAAI,KAAK,CAAC,QAAQ,EAAE,CAAC;QAC1B,CAAC,CAAC;;IAEN,QAAQ,CAAC,EAAE,CAAC,KAAK,EAAE,WAAW;KAC7B,IAAI,GAAG,GAAG,IAAI,CAAC,WAAW,CAAC,aAAa,EAAC;MACxC,IAAI,EAAE,IAAI,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,GAAG,CAAC,EAAC;MACjC,IAAI,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,EAAC;MAC3B,OAAO,CAAC,GAAG,CAAC,uBAAuB,CAAC,EAAE,EAAC;OACtC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;OAClB,CAAC,CAAC;;GAEN,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,SAAS,CAAC,EAAE;OACtB,OAAO,CAAC,KAAK,CAAC,CAAC,EAAC;GACpB,CAAC,CAAC;;EAEH,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;EACtB,OAAO,CAAC,GAAG,EAAE,CAAC;EACd;CACD;;AAED,MAAM,CAAC,OAAO,GAAG,gBAAgB,CAAC"}